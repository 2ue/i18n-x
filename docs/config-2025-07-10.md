# i18n-xy 配置指南

## 目录
- [基础配置](#基础配置)
  - [语言设置](#语言设置)
  - [文件路径配置](#文件路径配置)
- [文件处理配置](#文件处理配置)
  - [包含和排除规则](#包含和排除规则)
- [Key生成配置](#key生成配置)
  - [Key生成策略](#key生成策略)
  - [拼音转换选项](#拼音转换选项)
- [输出配置](#输出配置)
- [替换配置](#替换配置)
- [日志配置](#日志配置)
- [翻译配置](#翻译配置)
- [配置最佳实践](#配置最佳实践)

## 基础配置

### 语言设置

#### `locale`
- **类型**: `string`
- **默认值**: `"zh-CN"`
- **说明**: 指定项目的主要语言，通常是源代码中使用的语言
- **配置示例**:
  ```json
  {
    "locale": "zh-CN"
  }
  ```
- **效果示例**:
  ```
  📁 locales/
  └── zh-CN.json  // 主语言文件
  {
    "welcome": "欢迎",
    "submit": "提交"
  }
  ```

#### `displayLanguage`
- **类型**: `string`
- **默认值**: `"en-US"`
- **说明**: 指定翻译的语言
- **配置示例**:
  ```json
  {
    "displayLanguage": "en-US"
  }
  ```
- **效果示例**:
  ```
  📁 locales/
  ├── zh-CN.json  // 主语言文件
  └── zh-CN.json  // 翻译后的语言文件
  {
    "welcome": "Welcome",
    "submit": "Submit"
  }
  ```

### 文件路径配置

#### `outputDir`
- **类型**: `string`
- **默认值**: `"src/locales"`
- **说明**: 指定生成的语言文件存放目录
- **配置示例**:
  ```json
  {
    "outputDir": "src/locales"
  }
  ```
- **效果示例**:
  ```
  📁 项目结构
  src/
  ├── locales/              // 输出目录
  │   ├── zh-CN.json       // 中文翻译
  │   └── en-US.json       // 英文翻译
  ├── components/
  └── pages/
  ```

#### `tempDir`
- **类型**: `string`
- **默认值**: `undefined`
- **说明**: 指定处理后不会改变源文件，而是将原文件转换后按原始路径存放到临时存放目录
- **配置示例**:
  ```json
  {
    "tempDir": "temp/i18n"
  }
  ```
- **效果示例**:
  ```
  📁 项目结构
  src/
  ├── components/
  │   └── Button.tsx       // 原始文件
  └── pages/
      └── index.tsx        // 原始文件
  
  temp/
  └── i18n/               // 临时目录
      ├── components/
      │   └── Button.tsx  // 处理后的文件
      └── pages/
          └── index.tsx   // 处理后的文件
  
  // 原始文件 Button.tsx
  const Button = () => <button>点击提交</button>
  
  // 临时目录中的 Button.tsx
  const Button = () => <button>{t('dian_ji_ti_jiao')}</button>
  ```

## 文件处理配置

### 包含和排除规则

#### `include`
- **类型**: `string[]`
- **默认值**: 
  ```json
  [
    "src/**/*.{js,jsx,ts,tsx}",
  ]
  ```
- **说明**: 指定需要处理的文件匹配模式
- **配置示例**:
  ```json
  {
    "include": [
      "src/**/*.{js,ts}",
      "components/**/*.tsx"
    ]
  }
  ```
- **效果示例**:
  ```
  📁 项目结构
  src/
  ├── utils/
  │   ├── helper.js        ✅ 会被处理
  │   └── constants.ts     ✅ 会被处理
  ├── components/
  │   ├── Button.tsx      ✅ 会被处理
  │   └── Button.css      ❌ 不会被处理
  └── pages/
      ├── index.jsx       ❌ 不会被处理（不在include中）
      └── about.tsx       ❌ 不会被处理（不在include中）
  ```

#### `exclude`
- **类型**: `string[]`
- **默认值**:
  ```json
  [
    "node_modules/**",
    "dist/**",
    "build/**",
    "**/*.test.{js,jsx,ts,tsx}",
    "**/*.spec.{js,jsx,ts,tsx}"
  ]
  ```
- **说明**: 指定不需要处理的文件匹配模式
- **效果示例**:
  ```json
  {
    "exclude": [
      "**/node_modules/**",  // 排除所有 node_modules 目录
      "src/**/*.test.*",     // 排除测试文件
      "**/*.d.ts"           // 排除类型声明文件
    ]
  }
  ```
- **注意事项**:
  - exclude 的优先级高于 include
  - 建议排除测试文件、构建输出和第三方库

## Key生成配置

### Key生成策略

#### `keyGeneration`

##### `maxChineseLength`
- **类型**: `number`
- **默认值**: `10`
- **说明**: 用于生成key时截取的中文文本最大长度
- **配置示例**:
  ```json
  {
    "keyGeneration": {
      "maxChineseLength": 5
    }
  }
  ```
- **效果示例**:
  ```
  原始文本 -> 生成的key
  "提交" -> "ti_jiao"
  "这是一个很长的文本" -> "zhe_shi_yi_ge_hen_hash123"  // 超过5个字符，添加hash
  "用户管理配置页面" -> "yong_hu_guan_li_hash456"      // 截取前5个字符
  ```

##### `hashLength`
- **类型**: `number`
- **默认值**: `6`
- **说明**: 当key重复时添加的hash后缀长度
- **配置示例**:
  ```json
  {
    "keyGeneration": {
      "hashLength": 4
    }
  }
  ```
- **效果示例**:
  ```
  场景1：两处都使用了"提交"文本
  
  // 第一次遇到
  "提交" -> "ti_jiao"
  
  // 第二次遇到（假设reuseExistingKey为false）
  "提交" -> "ti_jiao_a1b2"  // 4位hash后缀

  场景2：文本超长
  
  "这是一个很长的文本" -> "zhe_shi_yi_ge_hen_he2f"  // 超过5个字符，添加hash
  ```

##### `maxRetryCount`
- **类型**: `number`
- **默认值**: `5`
- **说明**: 生成唯一key时的最大重试次数
- **注意事项**:
  - 当key重复时会重试生成新的key
  - 超过重试次数后会抛出错误

##### `reuseExistingKey`
- **类型**: `boolean`
- **默认值**: `true`
- **说明**: 相同文本是否使用相同的key
- **配置示例**:
  ```json
  {
    "keyGeneration": {
      "reuseExistingKey": true
    }
  }
  ```
- **效果示例**:
  ```typescript
  // 源代码
  function Page() {
    return (
      <>
        <button>提交</button>
        <div>
          <button>提交</button>
        </div>
      </>
    )
  }
  
  // reuseExistingKey: true
  function Page() {
    return (
      <>
        <button>{t('ti_jiao')}</button>
        <div>
          <button>{t('ti_jiao')}</button>  // 复用相同的key
        </div>
      </>
    )
  }
  
  // reuseExistingKey: false
  function Page() {
    return (
      <>
        <button>{t('ti_jiao')}</button>
        <div>
          <button>{t('ti_jiao_a1b2')}</button>  // 生成新的key
        </div>
      </>
    )
  }
  ```

##### `duplicateKeySuffix`
- **类型**: `"hash"`
- **默认值**: `"hash"`
- **说明**: 处理重复key的策略
- **效果示例**:
  当 `reuseExistingKey` 为 `false` 时，相同文本会生成不同的key：
  ```
  "欢迎" -> welcome_a1b2c3
  "欢迎" -> welcome_d4e5f6
  ```

##### `keyPrefix`
- **类型**: `string`
- **默认值**: `""`
- **说明**: 生成的key的前缀
- **配置示例**:
  ```json
  {
    "keyGeneration": {
      "keyPrefix": "user"
    }
  }
  ```
- **效果示例**:
  ```typescript
  // 源代码
  const UserProfile = () => (
    <div>
      <h1>用户信息</h1>
      <button>保存</button>
    </div>
  )
  
  // 转换后
  const UserProfile = () => (
    <div>
      <h1>{t('user_yong_hu_xin_xi')}</h1>
      <button>{t('user_bao_cun')}</button>
    </div>
  )
  
  // 生成的语言文件
  {
    "user_yong_hu_xin_xi": "用户信息",
    "user_bao_cun": "保存"
  }
  ```

##### `separator`
- **类型**: `string`
- **默认值**: `"_"`
- **说明**: key中用于连接的分隔符
- **配置示例**:
  ```json
  {
    "keyGeneration": {
      "separator": ".",
      "keyPrefix": "user"
    }
  }
  ```
- **效果示例**:
  ```typescript
  // 源代码
  const label = "用户名称";
  
  // separator: "_" （默认）
  t('user_yong_hu_ming_cheng')
  
  // separator: "."
  t('user.yong.hu.ming.cheng')
  
  // separator: "-"
  t('user-yong-hu-ming-cheng')
  ```

### 拼音转换选项

#### `pinyinOptions`
- **类型**: `object`
- **默认配置**:
  ```json
  {
    "toneType": "none",
    "type": "array"
  }
  ```
- **说明**: 控制中文转拼音的行为
- **效果示例**:
  ```typescript
  // 原文本: "用户设置"
  
  // toneType: "none", type: "array"
  ["yong", "hu", "she", "zhi"] -> "yong_hu_she_zhi"
  
  // toneType: "num", type: "array"
  ["yong4", "hu4", "she4", "zhi4"] -> "yong4_hu4_she4_zhi4"
  
  // toneType: "symbol", type: "array"
  ["yòng", "hù", "shè", "zhì"] -> "yòng_hù_shè_zhì"
  
  // type: "string"
  "yonghushezhi"
  ```

## 输出配置

#### `output`

##### `prettyJson`
- **类型**: `boolean`
- **默认值**: `true`
- **说明**: 是否格式化输出的JSON文件
- **效果示例**:
  ```json
  {
    "output": {
      "prettyJson": true
    }
  }
  ```
  生成的JSON文件会有适当的缩进和换行

##### `localeFileName`
- **类型**: `string`
- **默认值**: `"{locale}.json"`
- **说明**: 语言文件的命名模式
- **效果示例**:
  ```json
  {
    "output": {
      "localeFileName": "i18n-{locale}.json"
    }
  }
  ```
  生成的文件名会是 `i18n-zh-CN.json`

## 替换配置

#### `replacement`

##### `functionName`
- **类型**: `string`
- **默认值**: `"$t"`
- **说明**: 替换中文字符串时使用的函数名
- **配置示例**:
  ```json
  {
    "replacement": {
      "functionName": "t"
    }
  }
  ```
- **效果示例**:
  ```typescript
  // 源代码
  const title = "欢迎使用";
  const message = "请输入用户名";
  
  // functionName: "$t"
  const title = $t('huan_ying_shi_yong');
  const message = $t('qing_shu_ru_yong_hu_ming');
  
  // functionName: "t"
  const title = t('huan_ying_shi_yong');
  const message = t('qing_shu_ru_yong_hu_ming');
  
  // functionName: "i18n.t"
  const title = i18n.t('huan_ying_shi_yong');
  const message = i18n.t('qing_shu_ru_yong_hu_ming');
  ```

##### `quoteType`
- **类型**: `"single" | "double"`
- **默认值**: `"single"`
- **说明**: 替换后的字符串使用的引号类型
- **效果示例**:
  ```json
  {
    "replacement": {
      "quoteType": "single"
    }
  }
  ```
  生成的代码会使用单引号：`t('welcome')`

##### `autoImport`
- **类型**: `object`
- **默认值**: `{ enabled: false }`
- **说明**: 控制是否自动添加翻译函数的导入语句
- **配置示例**:
  ```json
  {
    "replacement": {
      "autoImport": {
        "enabled": true,
        "insertPosition": "afterImports",
        "imports": {
          "**/*.tsx": {
            "importStatement": "import { useTranslation } from 'react-i18next';\nconst { t } = useTranslation();"
          }
        }
      }
    }
  }
  ```
- **效果示例**:
  ```typescript
  // 源代码
  import React from 'react';
  import { Button } from './Button';
  
  const Page = () => (
    <div>欢迎</div>
  );
  
  // 转换后
  import React from 'react';
  import { Button } from './Button';
  import { useTranslation } from 'react-i18next';
  const { t } = useTranslation();
  
  const Page = () => (
    <div>{t('huan_ying')}</div>
  );
  ```

## 日志配置

#### `logging`
- **类型**: `object`
- **默认配置**:
  ```json
  {
    "enabled": true,
    "level": "normal"
  }
  ```
- **说明**: 控制工具运行时的日志输出
- **日志级别**:
  - `"minimal"`: 只显示错误和警告
  - `"normal"`: 显示基本处理信息
  - `"verbose"`: 显示详细调试信息

## 翻译配置

#### `translation`
- **类型**: `object`
- **默认值**: `{ enabled: false }`
- **说明**: 配置自动翻译功能（目前支持百度翻译）
- **配置示例**:
  ```json
  {
    "translation": {
      "enabled": true,
      "provider": "baidu",
      "defaultSourceLang": "zh",
      "defaultTargetLang": "en",
      "concurrency": 5,
      "retryTimes": 3,
      "baidu": {
        "appid": "your_app_id",
        "key": "your_api_key"
      }
    }
  }
  ```
- **效果示例**:
  ```
  📁 locales/
  ├── zh-CN.json
  {
    "huan_ying": "欢迎",
    "ti_jiao": "提交",
    "yong_hu_ming": "用户名"
  }
  
  ├── en-US.json（自动生成的翻译）
  {
    "huan_ying": "Welcome",
    "ti_jiao": "Submit",
    "yong_hu_ming": "Username"
  }
  ```

## 配置最佳实践

1. **开发环境配置建议**:
   ```json
   {
     "tempDir": "temp/i18n",
     "logging": {
       "level": "verbose"
     }
   }
   ```

2. **生产环境配置建议**:
   ```json
   {
     "tempDir": undefined,
     "logging": {
       "level": "minimal"
     }
   }
   ```

3. **大型项目配置建议**:
   ```json
   {
     "keyGeneration": {
       "keyPrefix": "module_name",
       "reuseExistingKey": false
     }
   }
   ```

4. **性能优化建议**:
   - 使用精确的 include/exclude 规则
   - 适当调整 maxChineseLength 和 hashLength
   - 合理设置翻译并发数

5. **团队协作建议**:
   - 统一 keyPrefix 命名规范
   - 保持一致的 separator 风格
   - 规范化 replacement.functionName 