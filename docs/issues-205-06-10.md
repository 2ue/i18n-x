# i18n-xy 转换问题分析报告

## 概述

本文档记录了使用 i18n-xy CLI 工具进行国际化转换时发现的问题。分析基于以下配置和文件：

- 配置文件：`i18n.config.json`
- 源文件目录：`/test/demo`
- 转换后文件目录：`/test/temp/test/demo`

## 问题分类

- 基础字符串处理问题
- React/JSX 相关问题
- 复杂场景处理问题
- 边缘情况处理问题

## 详细问题列表

### 1. 常量处理问题

#### 1.1 常量对象中的中文字符串处理不一致

**问题描述**：在处理常量对象时，某些中文字符串被转换为 i18n 函数调用，而某些则保持原样，导致处理不一致。

**源代码**：
```typescript
export const CHANGE_NODES_TEXT_MAP = {
  PERFECT_SCHEME: '完善方案',
  ASP_AUTHORIZATION: '预评估',
  ORIGINAL_FACTORY_AUTHORIZATION: '原厂管理授权',
  CUSTOMER_AUTHORIZATION: '客户授权',
  DEPLOYMENT_IMPLEMENTATION: '部署实施',
  CUSTOMER_ACCEPTANCE: '客户验收',
  FAILURE_FOLLOW_UP: '失败跟进',
};

export const DEPLOYMENT_TEXT_MAPS: Record<string, string> = {
  [DEPLOYMENT_MAPS.ASP]: 'ASP部署',
  [DEPLOYMENT_MAPS.CUSTOMER]: '客户部署',
  [DEPLOYMENT_MAPS.JIAOCHA]: '交叉部署',
  [DEPLOYMENT_MAPS.TENCENT]: '腾讯部署'
};
```

**当前转换结果**：
```typescript
export const CHANGE_NODES_TEXT_MAP = {
  PERFECT_SCHEME: '完善方案',  // 未转换
  ASP_AUTHORIZATION: '预评估',  // 未转换
  ORIGINAL_FACTORY_AUTHORIZATION: '原厂管理授权',  // 未转换
  CUSTOMER_AUTHORIZATION: '客户授权',  // 未转换
  DEPLOYMENT_IMPLEMENTATION: '部署实施',  // 未转换
  CUSTOMER_ACCEPTANCE: '客户验收',  // 未转换
  FAILURE_FOLLOW_UP: '失败跟进',  // 未转换
};

export const DEPLOYMENT_TEXT_MAPS: Record<string, string> = {
  [DEPLOYMENT_MAPS.ASP]: 'ASP部署',  // 未转换
  [DEPLOYMENT_MAPS.CUSTOMER]: '客户部署',  // 未转换
  [DEPLOYMENT_MAPS.JIAOCHA]: '交叉部署',  // 未转换
  [DEPLOYMENT_MAPS.TENCENT]: '腾讯部署'  // 未转换
};
```

**期望结果**：
```typescript
export const CHANGE_NODES_TEXT_MAP = {
  PERFECT_SCHEME: $t1('wan_shan_fang_an'),
  ASP_AUTHORIZATION: $t1('yu_ping_gu'),
  ORIGINAL_FACTORY_AUTHORIZATION: $t1('yuan_chang_guan_li_shou_quan'),
  CUSTOMER_AUTHORIZATION: $t1('ke_hu_shou_quan'),
  DEPLOYMENT_IMPLEMENTATION: $t1('bu_shu_shi_shi'),
  CUSTOMER_ACCEPTANCE: $t1('ke_hu_yan_shou'),
  FAILURE_FOLLOW_UP: $t1('shi_bai_gen_jin'),
};

export const DEPLOYMENT_TEXT_MAPS: Record<string, string> = {
  [DEPLOYMENT_MAPS.ASP]: $t1('asp_bu_shu'),
  [DEPLOYMENT_MAPS.CUSTOMER]: $t1('ke_hu_bu_shu'),
  [DEPLOYMENT_MAPS.JIAOCHA]: $t1('jiao_cha_bu_shu'),
  [DEPLOYMENT_MAPS.TENCENT]: $t1('teng_xun_bu_shu')
};
```

#### 1.2 注释处理问题

**问题描述**：在文件中，注释中的中文字符串也被错误地转换为 i18n 函数调用。

**源代码**：
```typescript
export const OPERATIONS_VALUE = {
  // 同意
  AGREE: '1',
  // 拒绝
  REFUSE: '2',
  // 认领
  CLAIM: '3',
  // 转单
  TRANSFORM: '3',
  // 更新
  UPDATE: '3',
  // 驳回
  JUMP: '4',
};
```

**当前转换结果**：
```typescript
export const OPERATIONS_VALUE = {
  // $t1('tong_yi')
  AGREE: '1',
  // $t1('ju_jue')
  REFUSE: '2',
  // $t1('ren_ling')
  CLAIM: '3',
  // $t1('zhuan_dan')
  TRANSFORM: '3',
  // $t1('geng_xin')
  UPDATE: '3',
  // $t1('bo_hui')
  JUMP: '4',
};
```

**期望结果**：
```typescript
export const OPERATIONS_VALUE = {
  // 同意
  AGREE: '1',
  // 拒绝
  REFUSE: '2',
  // 认领
  CLAIM: '3',
  // 转单
  TRANSFORM: '3',
  // 更新
  UPDATE: '3',
  // 驳回
  JUMP: '4',
};
```

#### 1.3 导入语句位置问题

**问题描述**：在转换文件时，i18n 相关的导入语句被添加到了错误的位置，应该在所有导入语句的最前面。

**源代码**：
```typescript
import { Something } from './something';
// 其他导入语句...

export const SOME_CONSTANT = '中文';
```

**当前转换结果**：
```typescript
import { Something } from './something';
// 其他导入语句...
import { useTranslation } from 'react-i18next';const { $t1 } = useTranslation();

export const SOME_CONSTANT = $t1('zhong_wen');
```

**期望结果**：
```typescript
import { useTranslation } from 'react-i18next';
import { Something } from './something';
// 其他导入语句...

const { $t1 } = useTranslation();

export const SOME_CONSTANT = $t1('zhong_wen');
```

#### 1.4 数组常量处理问题

**问题描述**：在处理数组类型的常量时，对象内的中文属性转换不完整。

**源代码**：
```typescript
export const CHANGE_STATUS = [
  { value: '0', text: '进行中', color: '#22C265' },
  { value: '1', text: '正常结束', color: '#AEAEAE' },
  { value: '2', text: '异常终止', color: '#E75151' },
];
```

**当前转换结果**：
```typescript
export const CHANGE_STATUS = [
  { value: '0', text: $t1('jin_xing_zhong'), color: '#22C265' },
  { value: '1', text: $t1('zheng_chang_jie_shu'), color: '#AEAEAE' },
  { value: '2', text: $t1('yi_chang_zhong_zhi'), color: '#E75151' }];
```

**期望结果**：
```typescript
export const CHANGE_STATUS = [
  { value: '0', text: $t1('jin_xing_zhong'), color: '#22C265' },
  { value: '1', text: $t1('zheng_chang_jie_shu'), color: '#AEAEAE' },
  { value: '2', text: $t1('yi_chang_zhong_zhi'), color: '#E75151' },
];
```

#### 1.5 长文本提示信息处理问题

**问题描述**：对于较长的提示文本，应该考虑是否需要进行国际化转换，以及如何处理文本中的特殊标记。

**源代码**：
```typescript
export const REFUSE_TEXTAREA = {
  1: '提交后流程将中止；若无与实际情况匹配的原因分类，可联系adayyang/jjingymeng',
  // ... 其他类似的长文本
};
```

**当前转换结果**：
```typescript
export const REFUSE_TEXTAREA = {
  1: '提交后流程将中止；若无与实际情况匹配的原因分类，可联系adayyang/jjingymeng',
  // ... 保持原样
};
```

**期望结果**：
```typescript
export const REFUSE_TEXTAREA = {
  1: $t1('ti_jiao_hou_liu_cheng_jiang_zhong_zhi', { contact: 'adayyang/jjingymeng' }),
  // ... 其他文本也需要类似处理
};
```

### 2. 基础字符串处理问题

#### 2.1 模板字符串处理问题

##### 2.1.1 多行模板字符串处理不当

**问题描述**：多行模板字符串在转换时丢失了原有的格式和换行。

**源代码**：
```javascript
const html = `
  <div>
    <h1>标题</h1>
    <p>内容</p>
  </div>
`;
```

**当前转换结果**：
```javascript
const html = $t1('biao_ti_nei_rong');
```

**期望结果**：
```javascript
const html = `
  <div>
    <h1>${$t1('biao_ti')}</h1>
    <p>${$t1('nei_rong')}</p>
  </div>
`;
```

#### 2.2 模板字符串表达式处理不完整

**问题描述**：包含表达式的模板字符串转换后丢失了原有的表达式结构。

**源代码**：
```javascript
const greeting = `你好，${name}`;
```

**当前转换结果**：
```javascript
const greeting = $t1('ni_hao_2pktas') + name;
```

**期望结果**：
```javascript
const greeting = `${$t1('ni_hao')}${name}`;
```

### 2. React/JSX 相关问题

#### 2.1 JSX 属性中的中文处理不当

**问题描述**：JSX 组件的属性中的中文字符串没有正确处理表达式的上下文。

**源代码**：
```tsx
<img
  src={user.avatar || '/default-avatar.png'}
  alt={`${user.name}的头像`}
  width={user.role === '管理员' ? 100 : 50}
/>
```

**当前转换结果**：
```tsx
<img
  src={user.avatar || '/default-avatar.png'}
  alt={user.name + $t1('de_tou_xiang')}
  width={user.role === $t1('guan_li_yuan') ? 100 : 50}
/>
```

**期望结果**：
```tsx
<img
  src={user.avatar || '/default-avatar.png'}
  alt={`${user.name}${$t1('de_tou_xiang')}`}
  width={user.role === $t1('guan_li_yuan') ? 100 : 50}
/>
```

#### 2.2 JSX 条件渲染中的格式问题

**问题描述**：条件渲染的 JSX 代码在转换后出现了不必要的换行和缩进问题。

**源代码**：
```tsx
{user.role === '管理员' && (
  <div className="admin-badge">
    管理员
  </div>
)}
```

**当前转换结果**：
```tsx
{user.role === $t1('guan_li_yuan') &&
<div className="admin-badge">{$t1('guan_li_yuan')}

</div>
}
```

**期望结果**：
```tsx
{user.role === $t1('guan_li_yuan') && (
  <div className="admin-badge">
    {$t1('guan_li_yuan')}
  </div>
)}
```

### 3. 复杂场景处理问题

#### 3.1 边缘情况处理问题

**问题描述**：在处理复杂场景时，某些中文字符串的处理不一致。

**源代码**：
```typescript
export const REFUSE_TEXTAREA = {
  1: '提交后流程将中止；若无与实际情况匹配的原因分类，可联系adayyang/jjingymeng',
  // ... 其他类似的长文本
};
```

**当前转换结果**：
```typescript
export const REFUSE_TEXTAREA = {
  1: '提交后流程将中止；若无与实际情况匹配的原因分类，可联系adayyang/jjingymeng',
  // ... 保持原样
};
```

**期望结果**：
```typescript
export const REFUSE_TEXTAREA = {
  1: $t1('ti_jiao_hou_liu_cheng_jiang_zhong_zhi', { contact: 'adayyang/jjingymeng' }),
  // ... 其他文本也需要类似处理
};
```

### 4. 边缘情况处理问题

#### 4.1 混合内容字符串处理不当

**问题描述**：包含中英文混合的字符串在转换时没有保留英文部分。

**源代码**：
```javascript
const mixedString1 = '这是mixed content字符串';
const mixedString2 = 'English text with 中文 inside';
```

**当前转换结果**：
```javascript
const mixedString1 = $t1('zhe_shi_zi_fu_chuan');
const mixedString2 = $t1('zhong_wen_11ddvf');
```

**期望结果**：
```javascript
const mixedString1 = `${$t1('zhe_shi')}mixed content${$t1('zi_fu_chuan')}`;
const mixedString2 = `English text with ${$t1('zhong_wen')} inside`;
```

#### 4.2 特殊字符处理问题

**问题描述**：包含特殊字符的中文字符串在转换时丢失了特殊字符。

**源代码**：
```javascript
const specialChars = '中文与特殊字符：!@#$%^&*()_+{}|:"<>?';
const unicodeChars = '中文与Unicode：\u2764\uFE0F \u263A\uFE0F \u1F60A';
```

**当前转换结果**：
```javascript
const specialChars = $t1('zhong_wen_yu_te_shu_zi_fu');
const unicodeChars = $t1('zhong_wen_yu');
```

**期望结果**：
```javascript
const specialChars = `${$t1('zhong_wen_yu_te_shu_zi_fu')}：!@#$%^&*()_+{}|:"<>?`;
const unicodeChars = `${$t1('zhong_wen_yu_unicode')}：\u2764\uFE0F \u263A\uFE0F \u1F60A`;
```

#### 4.3 HTML/XML 标签处理问题

**问题描述**：包含 HTML/XML 标签的中文字符串在转换时丢失了标签结构。

**源代码**：
```javascript
const htmlMixed = '这是<strong>加粗</strong>和<em>斜体</em>文本';
const xmlMixed = '<user name="张三">用户信息</user>';
```

**当前转换结果**：
```javascript
const htmlMixed = $t1('zhe_shi_jia_cu_he_xie_ti_wen_ben');
const xmlMixed = $t1('zhang_san_yong_hu_xin_xi');
```

**期望结果**：
```javascript
const htmlMixed = `${$t1('zhe_shi')}<strong>${$t1('jia_cu')}</strong>${$t1('he')}<em>${$t1('xie_ti')}</em>${$t1('wen_ben')}`;
const xmlMixed = `<user name="${$t1('zhang_san')}">${$t1('yong_hu_xin_xi')}</user>`;
```

#### 4.4 路径字符串处理问题

**问题描述**：包含路径的中文字符串在转换时没有保留路径结构。

**源代码**：
```javascript
const filePath = 'C:\\用户\\文档\\file.txt';
const unixPath = '/home/用户/文档/file.txt';
```

**当前转换结果**：
```javascript
const filePath = $t1('yong_hu_wen_dang');
const unixPath = $t1('yong_hu_wen_dang_1ly9ha');
```

**期望结果**：
```javascript
const filePath = `C:\\${$t1('yong_hu')}\\${$t1('wen_dang')}\\file.txt`;
const unixPath = `/home/${$t1('yong_hu')}/${$t1('wen_dang')}/file.txt`;
```

#### 4.5 JSON 字符串处理问题

**问题描述**：JSON 格式的中文字符串在转换时丢失了 JSON 结构。

**源代码**：
```javascript
const jsonString = '{"name":"张三","age":25,"title":"工程师"}';
```

**当前转换结果**：
```javascript
const jsonString = $t1('zhang_san_gong_cheng_shi');
```

**期望结果**：
```javascript
const jsonString = JSON.stringify({
  name: $t1('zhang_san'),
  age: 25,
  title: $t1('gong_cheng_shi')
});
```

#### 4.6 正则表达式模式处理问题

**问题描述**：包含中文的正则表达式模式字符串被错误转换。

**源代码**：
```javascript
const regexPattern = /用户名：(.+)，年龄：(\d+)/;
const regexString = '用户名：张三，年龄：25';
```

**当前转换结果**：
```javascript
const regexPattern = /用户名：(.+)，年龄：(\d+)/; // 未转换
const regexString = $t1('yong_hu_ming_zhang_san_nian_ling');
```

**期望结果**：
```javascript
const regexPattern = new RegExp(`${$t1('yong_hu_ming')}：(.+)，${$t1('nian_ling')}：(\\d+)`);
const regexString = `${$t1('yong_hu_ming')}：${$t1('zhang_san')}，${$t1('nian_ling')}：25`;
```

#### 4.7 注释处理问题

**问题描述**：代码注释中的中文被错误地添加到翻译文件中。

**源代码**：
```javascript
const code = '这是代码'; // 这是中文注释
/* 这是多行注释，
   不应该被替换 */
```

**当前转换结果**：
```javascript
const code = $t1('zhe_shi_dai_ma'); // 这是中文注释
/* 这是多行注释，
   不应该被替换 */
```

**期望结果**：
```javascript
// 注释应该保持原样，不进行转换
const code = $t1('zhe_shi_dai_ma'); // 这是中文注释
/* 这是多行注释，
   不应该被替换 */
```

### 5. 性能优化建议

1. **分块处理大文件**：对于大型文件，应该采用分块处理的方式，避免一次性加载整个文件到内存。

2. **缓存优化**：
   - 对于重复出现的中文字符串，应该复用已生成的 key
   - 缓存 AST 解析结果，避免重复解析相同的代码结构

3. **并行处理**：
   - 多个文件的处理可以并行进行
   - 翻译 API 调用可以使用批量接口

4. **增量更新**：
   - 支持增量更新模式，只处理变更的文件
   - 保留已有的翻译 key，避免重新生成

5. **错误恢复**：
   - 单个文件处理失败不应影响其他文件的处理
   - 提供回滚机制，在处理失败时恢复原始文件

### 6. 建议的改进方向

1. **配置增强**：
   - 添加更细粒度的转换规则配置
   - 支持自定义转换规则
   - 添加忽略特定代码块的配置

2. **代码格式化**：
   - 集成代码格式化工具
   - 保持原有的代码风格
   - 支持自定义格式化规则

3. **类型系统增强**：
   - 更好地处理 TypeScript 类型定义
   - 支持泛型和复杂类型结构
   - 保持类型安全

4. **模板增强**：
   - 支持自定义模板字符串处理规则
   - 更智能的字符串分割和合并
   - 保持原有的模板结构

5. **边缘情况处理**：
   - 完善混合内容处理
   - 增强特殊字符处理
   - 改进路径字符串处理
   - 优化 JSON 字符串处理
   - 完善正则表达式处理 

### 7. React 组件中的常量处理问题

#### 7.1 React 组件中的选项数组格式化问题

**问题描述**：在 React 组件中，包含中文的选项数组在转换后出现了不必要的换行和格式化问题。

**源代码**：
```typescript
export const REFUSE_REASON_OPTIONS = {
  [CHANGE_NODES_MAP.PERFECT_SCHEME]: [
    'N客户未使用到该产品/版本',
    'N客户取消变更',
    'N内部取消变更',
  ],
  // ... 其他选项
};
```

**当前转换结果**：
```typescript
export const REFUSE_REASON_OPTIONS = {
  [CHANGE_NODES_MAP.PERFECT_SCHEME]: [$t1('ke_hu_wei_shi_yong_dao_gai_chan_pin_ban'), $t1('ke_hu_qu_xiao_bian_geng'), $t1('nei_bu_qu_xiao_bian_geng')],




  // ... 其他选项，每个选项之间有多个空行
};
```

**期望结果**：
```typescript
export const REFUSE_REASON_OPTIONS = {
  [CHANGE_NODES_MAP.PERFECT_SCHEME]: [
    $t1('ke_hu_wei_shi_yong_dao_gai_chan_pin_ban'),
    $t1('ke_hu_qu_xiao_bian_geng'),
    $t1('nei_bu_qu_xiao_bian_geng'),
  ],
  // ... 其他选项，保持原有的格式
};
```

#### 7.2 重复变量定义问题

**问题描述**：在转换过程中，某些变量被重复定义，导致代码冗余。

**源代码**：
```typescript
const allOption = hasAllOption ? {
  text: '全部',
  value: '__ALL',
} : undefined;
```

**当前转换结果**：
```typescript
const allOption = hasAllOption ? {
  text: $t1('quan_bu'),
  value: '__ALL'
} : undefined;

export function OperationReasonSelect(props: Props) {
  const [options, setOptions] = useState<SelectOption[]>([]);
  const allOption = hasAllOption ? {  // 重复定义
    text: '全部',  // 未转换
    value: '__ALL'
  } : undefined;
  // ... 其他代码
}
```

**期望结果**：
```typescript
const allOption = hasAllOption ? {
  text: $t1('quan_bu'),
  value: '__ALL'
} : undefined;

export function OperationReasonSelect(props: Props) {
  const [options, setOptions] = useState<SelectOption[]>([]);
  // 移除重复定义，使用上面定义的 allOption
  // ... 其他代码
}
```

#### 7.3 导入语句合并问题

**问题描述**：在添加 i18n 相关的导入语句时，没有正确处理与现有导入语句的合并。

**源代码**：
```typescript
import { Select, SelectOption, SelectProps } from '@tencent/tea-component';
import { useEffect, useState } from 'react';
import { CHANGE_NODES_MAP, OPERATIONS_VALUE } from '../../enums';
```

**当前转换结果**：
```typescript
import { Select, SelectOption, SelectProps } from '@tencent/tea-component';
import { useEffect, useState } from 'react';
import { CHANGE_NODES_MAP, OPERATIONS_VALUE } from '../../enums';import { useTranslation } from 'react-i18next';const { $t1 } = useTranslation();
```

**期望结果**：
```typescript
import { useTranslation } from 'react-i18next';
import { Select, SelectOption, SelectProps } from '@tencent/tea-component';
import { useEffect, useState } from 'react';
import { CHANGE_NODES_MAP, OPERATIONS_VALUE } from '../../enums';

const { $t1 } = useTranslation();
```

#### 7.4 组件属性中的中文处理问题

**问题描述**：组件的属性中的中文字符串有些被转换，有些未被转换，处理不一致。

**源代码**：
```typescript
return <Select
  style={{ minWidth: '200px' }}
  matchButtonWidth
  appearance="button"
  placeholder="请选择原因分类"
  clearable
  searchable={true}
  options={options}
  {...props}
/>;
```

**当前转换结果**：
```typescript
return <Select
  style={{ minWidth: '200px' }}
  matchButtonWidth
  appearance="button"
  placeholder={$t1('qing_xuan_ze_yuan_yin_fen_lei')}
  clearable
  searchable={true}
  options={options}
  {...props}
/>;
```

**期望结果**：
```typescript
return <Select
  style={{ minWidth: '200px' }}
  matchButtonWidth
  appearance="button"
  placeholder={$t1('qing_xuan_ze_yuan_yin_fen_lei')}
  clearable
  searchable={true}
  options={options}
  {...props}
/>;
```

### 8. 代码格式化问题

#### 8.1 错误消息的国际化处理问题

**问题描述**：在错误处理和日志输出中，错误消息的国际化处理不一致，有些被转换而有些保持原样。

**源代码**：
```typescript
try {
  // ... 代码
  throw new Error(`请求接口${api}失败: ${code}`);
} catch (e: any) {
  console.error('获取数据失败', e);
  return {} as any;
}
```

**当前转换结果**：
```typescript
try {
  // ... 代码
  throw new Error(`请求接口${api}失败: ${code}`);  // 未转换
} catch (e: any) {
  console.error($t1('huo_qu_shu_ju_shi_bai'), e);  // 已转换
  return {} as any;
}
```

**期望结果**：
```typescript
try {
  // ... 代码
  throw new Error($t1('qing_qiu_jie_kou_shi_bai', { api, code }));
} catch (e: any) {
  console.error($t1('huo_qu_shu_ju_shi_bai'), e);
  return {} as any;
}
```

#### 8.2 HTML 模板中的中文处理不当

**问题描述**：在处理包含 HTML 的模板字符串时，转换后的代码格式被破坏，且字符串拼接逻辑混乱。

**源代码**：
```typescript
return `<table cellspacing="0" cellpadding="5" style="width: 100%; border: 0.5px solid #D4D5D7">
  <thead>
    <tr style="text-align: left">
      <th bgcolor="${thBgcolor}" style="${fontSize};${thWidth}">三级目录</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">四级目录</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">处理人</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">优先级</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">待办描述</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">计划完成时间</th>
    </tr>
  </thead>
  <tbody>
    ${cols}
  </tbody>
</table>`;
```

**当前转换结果**：
```typescript
return '<table cellspacing="0" cellpadding="5" style="width: 100%; border: 0.5px solid #D4D5D7">\n        <thead>\n          <tr style="text-align: left">\n            <th bgcolor="' +
  thBgcolor + '" style="' + fontSize + ';' + thWidth + $t1('san_ji_mu_lu') +
  fontSize + ';' + thBorderL + ';' + thWidth + '" bgcolor="' + thBgcolor + $t1('si_ji_mu_lu') +
  fontSize + ';' + thBorderL + ';' + thWidth + '" bgcolor="' + thBgcolor + $t1('chu_li_ren') +
  fontSize + ';' + thBorderL + ';' + thWidth + '" bgcolor="' + thBgcolor + $t1('you_xian_ji') +
  fontSize + ';' + thBorderL + ';' + thWidth + '" bgcolor="' + thBgcolor + $t1('dai_ban_miao_shu') +
  fontSize + ';' + thBorderL + ';' + thWidth + '" bgcolor="' + thBgcolor + $t1('ji_hua_wan_cheng_shi_jian') +
  cols + '\n        </tbody>\n      </table>';
```

**期望结果**：
```typescript
return `<table cellspacing="0" cellpadding="5" style="width: 100%; border: 0.5px solid #D4D5D7">
  <thead>
    <tr style="text-align: left">
      <th bgcolor="${thBgcolor}" style="${fontSize};${thWidth}">${$t1('san_ji_mu_lu')}</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">${$t1('si_ji_mu_lu')}</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">${$t1('chu_li_ren')}</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">${$t1('you_xian_ji')}</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">${$t1('dai_ban_miao_shu')}</th>
      <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">${$t1('ji_hua_wan_cheng_shi_jian')}</th>
    </tr>
  </thead>
  <tbody>
    ${cols}
  </tbody>
</table>`;
```

#### 8.3 条件渲染中的默认文本处理问题

**问题描述**：在条件渲染中的默认文本和占位符文本的处理不一致。

**源代码**：
```typescript
if (!list.length) return '<div>暂无数据</div>';
const cols = list.map((v: any) => `
  <td>${treeIdMap?.[v.level3]?.Name || '其它诉求'}</td>
  <td>${treeIdMap?.[v.level4]?.Name || '自闭环待办'}</td>
`);
```

**当前转换结果**：
```typescript
if (!list.length) return $t1('zan_wu_shu_ju_1czcgv');
const cols = list.map((v: any) => `
  <td>${treeIdMap?.[v.level3]?.Name || $t1('qi_ta_su_qiu')}</td>
  <td>${treeIdMap?.[v.level4]?.Name || $t1('zi_bi_huan_dai_ban')}</td>
`);
```

**期望结果**：
```typescript
if (!list.length) return `<div>${$t1('zan_wu_shu_ju')}</div>`;
const cols = list.map((v: any) => `
  <td>${treeIdMap?.[v.level3]?.Name || $t1('qi_ta_su_qiu')}</td>
  <td>${treeIdMap?.[v.level4]?.Name || $t1('zi_bi_huan_dai_ban')}</td>
`);
``` 

### 9. JSX 处理问题

#### 9.1 JSX 属性中的中文处理不一致

**问题描述**：在 JSX 属性中，中文字符串的处理方式不一致，有些被转换为 i18n 函数调用，有些保持原样。

**源代码**：
```jsx
export function AttributeComponent() {
  return (
    <div>
      <input placeholder="请输入密码" title="密码输入框" />
      <button aria-label="提交表单">提交</button>
      <img src="/logo.png" alt="公司logo" />
    </div>
  );
}
```

**当前转换结果**：
```jsx
export function AttributeComponent() {
  return (
    <div>
      <input placeholder={$t1('qing_shu_ru_mi_ma')} title={$t1('mi_ma_shu_ru_kuang')} />
      <button aria-label={$t1('ti_jiao_biao_dan')}>{$t1('ti_jiao')}</button>
      <img src="/logo.png" alt={$t1('gong_si')} />
    </div>
  );
}
```

**期望结果**：
```jsx
// 应该先定义常量
export const FormLabels = {
  PASSWORD_PLACEHOLDER: $t1('qing_shu_ru_mi_ma'),
  PASSWORD_TITLE: $t1('mi_ma_shu_ru_kuang'),
  SUBMIT_LABEL: $t1('ti_jiao_biao_dan'),
  SUBMIT_TEXT: $t1('ti_jiao'),
  LOGO_ALT: $t1('gong_si_logo')
} as const;

export function AttributeComponent() {
  return (
    <div>
      <input placeholder={FormLabels.PASSWORD_PLACEHOLDER} title={FormLabels.PASSWORD_TITLE} />
      <button aria-label={FormLabels.SUBMIT_LABEL}>{FormLabels.SUBMIT_TEXT}</button>
      <img src="/logo.png" alt={FormLabels.LOGO_ALT} />
    </div>
  );
}
```

#### 9.2 JSX 条件渲染中的字符串处理问题

**问题描述**：在 JSX 条件渲染中，字符串字面量的处理不一致。

**源代码**：
```jsx
export function ConditionalRendering() {
  const isVisible = true;
  return (
    <div>
      {isVisible && <p>显示内容</p>}
      {isVisible ? <span>可见状态</span> : <span>隐藏状态</span>}
    </div>
  );
}

export function ExpressionContainer() {
  return (
    <div>
      <p>{'内容详情'}</p>
      {true && '条件渲染的文本'}
      {false || '逻辑或的文本'}
    </div>
  );
}
```

**当前转换结果**：
```jsx
export function ConditionalRendering() {
  const isVisible = true;
  return (
    <div>
      {isVisible && <p>{$t1('xian_shi_nei_rong')}</p>}
      {isVisible ? <span>{$t1('ke_jian_zhuang_tai')}</span> : <span>{$t1('yin_cang_zhuang_tai')}</span>}
    </div>
  );
}

export function ExpressionContainer() {
  return (
    <div>
      <p>{$t1('nei_rong_xiang_qing')}</p>
      {true && '条件渲染的文本'}  // 未转换
      {false || '逻辑或的文本'}  // 未转换
    </div>
  );
}
```

**期望结果**：
```jsx
// 应该先定义常量
export const UIText = {
  SHOW_CONTENT: $t1('xian_shi_nei_rong'),
  VISIBLE_STATUS: $t1('ke_jian_zhuang_tai'),
  HIDDEN_STATUS: $t1('yin_cang_zhuang_tai'),
  CONTENT_DETAILS: $t1('nei_rong_xiang_qing'),
  CONDITIONAL_TEXT: $t1('tiao_jian_xuan_ran_de_wen_ben'),
  LOGICAL_OR_TEXT: $t1('luo_ji_huo_de_wen_ben')
} as const;

export function ConditionalRendering() {
  const isVisible = true;
  return (
    <div>
      {isVisible && <p>{UIText.SHOW_CONTENT}</p>}
      {isVisible ? <span>{UIText.VISIBLE_STATUS}</span> : <span>{UIText.HIDDEN_STATUS}</span>}
    </div>
  );
}

export function ExpressionContainer() {
  return (
    <div>
      <p>{UIText.CONTENT_DETAILS}</p>
      {true && UIText.CONDITIONAL_TEXT}
      {false || UIText.LOGICAL_OR_TEXT}
    </div>
  );
}
```

#### 9.3 JSX 数组映射中的字符串处理问题

**问题描述**：在 JSX 数组映射中，对象字面量和默认值的处理不一致。

**源代码**：
```jsx
export function ArrayLiterals() {
  return (
    <div>
      <ul>
        {['确定', '取消'].map(txt => <li key={txt}>{txt}</li>)}
      </ul>
      <select>
        {[
          { label: '选项一', value: 1 },
          { label: '选项二', value: 2 }
        ].map(option => (
          <option key={option.value} value={option.value}>{option.label}</option>
        ))}
      </select>
    </div>
  );
}

export function ComplexJSX() {
  const items = [
    { id: 1, name: '项目一' },
    { id: 2, name: '项目二' }
  ];

  return (
    <div>
      {items.map(item => (
        <div key={item.id} className="item">
          {item.name || '未命名项目'}
        </div>
      ))}
    </div>
  );
}
```

**当前转换结果**：
```jsx
export function ArrayLiterals() {
  return (
    <div>
      <ul>
        {[$t1('que_ding'), $t1('qu_xiao')].map((txt) => <li key={txt}>{txt}</li>)}
      </ul>
      <select>
        {[
          { label: $t1('xuan_xiang_yi'), value: 1 },
          { label: $t1('xuan_xiang_er'), value: 2 }
        ].map((option) => (
          <option key={option.value} value={option.value}>{option.label}</option>
        ))}
      </select>
    </div>
  );
}

export function ComplexJSX() {
  const items = [
    { id: 1, name: $t1('xiang_mu_yi') },
    { id: 2, name: $t1('xiang_mu_er') }
  ];

  return (
    <div>
      {items.map((item) => (
        <div key={item.id} className="item">
          {item.name || '未命名项目'}  // 默认值未转换
        </div>
      ))}
    </div>
  );
}
```

**期望结果**：
```jsx
// 应该先定义常量
export const ButtonLabels = {
  CONFIRM: $t1('que_ding'),
  CANCEL: $t1('qu_xiao')
} as const;

export const SelectOptions = {
  OPTION_ONE: $t1('xuan_xiang_yi'),
  OPTION_TWO: $t1('xuan_xiang_er')
} as const;

export const ProjectLabels = {
  PROJECT_ONE: $t1('xiang_mu_yi'),
  PROJECT_TWO: $t1('xiang_mu_er'),
  UNNAMED: $t1('wei_ming_ming_xiang_mu')
} as const;

export function ArrayLiterals() {
  return (
    <div>
      <ul>
        {[ButtonLabels.CONFIRM, ButtonLabels.CANCEL].map((txt) => <li key={txt}>{txt}</li>)}
      </ul>
      <select>
        {[
          { label: SelectOptions.OPTION_ONE, value: 1 },
          { label: SelectOptions.OPTION_TWO, value: 2 }
        ].map((option) => (
          <option key={option.value} value={option.value}>{option.label}</option>
        ))}
      </select>
    </div>
  );
}

export function ComplexJSX() {
  const items = [
    { id: 1, name: ProjectLabels.PROJECT_ONE },
    { id: 2, name: ProjectLabels.PROJECT_TWO }
  ];

  return (
    <div>
      {items.map((item) => (
        <div key={item.id} className="item">
          {item.name || ProjectLabels.UNNAMED}
        </div>
      ))}
    </div>
  );
}
```

### 10. React TypeScript 模板组件问题

#### 10.1 HTML 模板字符串拼接问题

**问题描述**：在处理包含 HTML 的模板字符串时，转换后的代码格式被破坏，且字符串拼接逻辑混乱。

**源代码**：
```typescript
const renderConclusionList = (list: string) => {
  if (!arr.length) return '<div>暂无数据</div>';
  const cols = arr
    .map((v: any) => `
        <tr>
          <td style="${fontSize};${thBorderT}">${v?.user || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.desc || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.jielun || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.remark || ''}</td>
        </tr>`)
    .join('');
  return `<table cellspacing="0" cellpadding="5" style="width: 100%; border: 0.5px solid #D4D5D7">
        <thead>
          <tr style="text-align: left">
            <th bgcolor="${thBgcolor}" style="${fontSize};${thWidth}">提出人</th>
            <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">确认项描述</th>
            <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">结论</th>
            <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">备注</th>
          </tr>
        </thead>
        <tbody>
          ${cols}
        </tbody>
      </table>`;
};
```

**当前转换结果**：
```typescript
const renderConclusionList = (list: string) => {
  if (!arr.length) return $t1('zan_wu_shu_ju_1czcgv');
  const cols = arr.
  map((v: any) => `
        <tr>
          <td style="${fontSize};${thBorderT}">${v?.user || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.desc || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.jielun || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.remark || ''}</td>
        </tr>`).
  join('');
  return '<table cellspacing="0" cellpadding="5" style="width: 100%; border: 0.5px solid #D4D5D7">\n        <thead>\n          <tr style="text-align: left">\n            <th bgcolor="' +
  thBgcolor + '" style="' + fontSize + ';' + thWidth + $t1('ti_chu_ren') +
  fontSize + ';' + thBorderL + ';' + thWidth + '" bgcolor="' + thBgcolor + $t1('que_ren_xiang_miao_shu') +
  fontSize + ';' + thBorderL + ';' + thWidth + '" bgcolor="' + thBgcolor + $t1('jie_lun') +
  fontSize + ';' + thBorderL + ';' + thWidth + '" bgcolor="' + thBgcolor + $t1('bei_zhu') +
  cols + '\n        </tbody>\n      </table>';
};
```

**期望结果**：
```typescript
// 应该先定义表头常量
export const TableHeaders = {
  SUBMITTER: $t1('ti_chu_ren'),
  DESCRIPTION: $t1('que_ren_xiang_miao_shu'),
  CONCLUSION: $t1('jie_lun'),
  REMARK: $t1('bei_zhu')
} as const;

const renderConclusionList = (list: string) => {
  if (!arr.length) return `<div>${$t1('zan_wu_shu_ju')}</div>`;
  const cols = arr
    .map((v: any) => `
        <tr>
          <td style="${fontSize};${thBorderT}">${v?.user || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.desc || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.jielun || ''}</td>
          <td style="${fontSize};${tdBorderLT}">${v?.remark || ''}</td>
        </tr>`)
    .join('');
  return `<table cellspacing="0" cellpadding="5" style="width: 100%; border: 0.5px solid #D4D5D7">
        <thead>
          <tr style="text-align: left">
            <th bgcolor="${thBgcolor}" style="${fontSize};${thWidth}">${TableHeaders.SUBMITTER}</th>
            <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">${TableHeaders.DESCRIPTION}</th>
            <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">${TableHeaders.CONCLUSION}</th>
            <th style="${fontSize};${thBorderL};${thWidth}" bgcolor="${thBgcolor}">${TableHeaders.REMARK}</th>
          </tr>
        </thead>
        <tbody>
          ${cols}
        </tbody>
      </table>`;
};
```

#### 10.2 React 组件中的文本拼接问题

**问题描述**：在 React 组件中，文本拼接和条件渲染的处理不一致。

**源代码**：
```tsx
<p style={{ marginTop: 10, fontWeight: 600 }}>
  {location.host.includes('test') ? '【测试邮件】' : ''}我是您的专属售后支持，以下为本次与 {data?.CustomerName || ''} 的会议纪要，请查收。
</p>
```

**当前转换结果**：
```tsx
<p style={{ marginTop: 10, fontWeight: 600 }}>
  {location.host.includes('test') ? $t1('ce_shi_you_jian') : ''}{$t1('wo_shi_nin_de_zhuan_shu_shou_hou_zhi_chi')}{data?.CustomerName || ''}{$t1('de_hui_yi_ji_yao_qing_cha_shou')}
</p>
```

**期望结果**：
```tsx
// 应该先定义文本常量
export const EmailText = {
  TEST_EMAIL: $t1('ce_shi_you_jian'),
  SUPPORT_INTRO: $t1('support_intro', { customer: data?.CustomerName || '' })
} as const;

<p style={{ marginTop: 10, fontWeight: 600 }}>
  {location.host.includes('test') ? EmailText.TEST_EMAIL : ''}
  {EmailText.SUPPORT_INTRO}
</p>
```

#### 10.3 枚举映射处理问题

**问题描述**：在处理枚举映射时，没有统一的处理方式。

**源代码**：
```typescript
// 客情
const customMap: any = {
  1: '正常',
  2: '一般',
  3: '重大'
};

// 优先级
const priorityMap: any = {
  L1: 'L1',
  L2: 'L2',
  L3: 'L3',
  L4: 'L4'
};
```

**当前转换结果**：
```typescript
// 客情
const customMap: any = {
  1: $t1('zheng_chang'),
  2: $t1('yi_ban'),
  3: $t1('zhong_da')
};

// 优先级
const priorityMap: any = {
  L1: 'L1',  // 未转换
  L2: 'L2',  // 未转换
  L3: 'L3',  // 未转换
  L4: 'L4'   // 未转换
};
```

**期望结果**：
```typescript
// 应该使用枚举或常量对象
export enum CustomerStatus {
  NORMAL = 1,
  MEDIUM = 2,
  HIGH = 3
}

export const CustomerStatusText = {
  [CustomerStatus.NORMAL]: $t1('zheng_chang'),
  [CustomerStatus.MEDIUM]: $t1('yi_ban'),
  [CustomerStatus.HIGH]: $t1('zhong_da')
} as const;

export enum PriorityLevel {
  L1 = 'L1',
  L2 = 'L2',
  L3 = 'L3',
  L4 = 'L4'
}

export const PriorityText = {
  [PriorityLevel.L1]: $t1('priority_l1'),
  [PriorityLevel.L2]: $t1('priority_l2'),
  [PriorityLevel.L3]: $t1('priority_l3'),
  [PriorityLevel.L4]: $t1('priority_l4')
} as const;
```

### 11. TypeScript 装饰器处理问题

#### 11.1 装饰器参数中的字符串处理问题

**问题描述**：在装饰器参数中，默认值和配置对象中的中文字符串处理不一致。

**源代码**：
```typescript
function Logger(loggerOptions: { prefix?: string; enabled?: boolean } = {}) {
  const options = {
    prefix: '系统日志',
    enabled: true,
    ...loggerOptions
  };
  // ...
}

function Deprecated(message: string = '此方法已过时') {
  // ...
}

@Logger({ prefix: '用户服务' })
class UserService {
  // ...
}
```

**当前转换结果**：
```typescript
function Logger(loggerOptions: { prefix?: string; enabled?: boolean } = {}) {
  const options = {
    prefix: $t1('xi_tong_ri_zhi'),
    enabled: true,
    ...loggerOptions
  };
  // ...
}

function Deprecated(message: string = $t1('ci_fang_fa_yi_guo_shi')) {
  // ...
}

@Logger({ prefix: $t1('yong_hu_fu_wu') })
class UserService {
  // ...
}
```

**期望结果**：
```typescript
// 应该先定义常量
export const LoggerDefaults = {
  SYSTEM_LOG: $t1('xi_tong_ri_zhi'),
  USER_SERVICE: $t1('yong_hu_fu_wu'),
  METHOD_DEPRECATED: $t1('ci_fang_fa_yi_guo_shi')
} as const;

function Logger(loggerOptions: { prefix?: string; enabled?: boolean } = {}) {
  const options = {
    prefix: LoggerDefaults.SYSTEM_LOG,
    enabled: true,
    ...loggerOptions
  };
  // ...
}

function Deprecated(message: string = LoggerDefaults.METHOD_DEPRECATED) {
  // ...
}

@Logger({ prefix: LoggerDefaults.USER_SERVICE })
class UserService {
  // ...
}
```

#### 11.2 装饰器日志消息处理问题

**问题描述**：在装饰器中的日志消息和错误消息处理不一致。

**源代码**：
```typescript
private _logger = {
  log: (message: string) => {
    if (options.enabled) {
      console.log(`[${options.prefix}] ${message}`);
    }
  },
  error: (message: string) => {
    if (options.enabled) {
      console.error(`[${options.prefix}-错误] ${message}`);
    }
  },
  warn: (message: string) => {
    if (options.enabled) {
      console.warn(`[${options.prefix}-警告] ${message}`);
    }
  }
};

constructor(...args: any[]) {
  super(...args);
  this._logger.log('实例已创建');
}
```

**当前转换结果**：
```typescript
private _logger = {
  log: (message: string) => {
    if (options.enabled) {
      console.log(`[${options.prefix}] ${message}`);
    }
  },
  error: (message: string) => {
    if (options.enabled) {
      console.error('[' + options.prefix + $t1('cuo_wu_293oxv') + message);  // 格式不一致
    }
  },
  warn: (message: string) => {
    if (options.enabled) {
      console.warn('[' + options.prefix + $t1('jing_gao_1totyx') + message);  // 格式不一致
    }
  }
};

constructor(...args: any[]) {
  super(...args);
  this._logger.log($t1('shi_li_yi_chuang_jian'));
}
```

**期望结果**：
```typescript
// 应该先定义常量
export const LoggerMessages = {
  ERROR: $t1('cuo_wu'),
  WARNING: $t1('jing_gao'),
  INSTANCE_CREATED: $t1('shi_li_yi_chuang_jian')
} as const;

private _logger = {
  log: (message: string) => {
    if (options.enabled) {
      console.log(`[${options.prefix}] ${message}`);
    }
  },
  error: (message: string) => {
    if (options.enabled) {
      console.error(`[${options.prefix}-${LoggerMessages.ERROR}] ${message}`);
    }
  },
  warn: (message: string) => {
    if (options.enabled) {
      console.warn(`[${options.prefix}-${LoggerMessages.WARNING}] ${message}`);
    }
  }
};

constructor(...args: any[]) {
  super(...args);
  this._logger.log(LoggerMessages.INSTANCE_CREATED);
}
```

#### 11.3 装饰器错误消息处理问题

**问题描述**：在装饰器中的错误消息和验证消息处理不一致。

**源代码**：
```typescript
function MinLength(minLength: number) {
  return function (target: any, propertyKey: string) {
    let value: string;
    const setter = function (newValue: string) {
      if (newValue.length < minLength) {
        throw new Error(`${propertyKey} 长度不能小于 ${minLength} 个字符`);
      }
      value = newValue;
    };
    // ...
  };
}

function Validate(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  const requiredParams: number[] = Reflect.getOwnMetadata('required', target, propertyKey) || [];

  descriptor.value = function (...args: any[]) {
    for (const index of requiredParams) {
      if (args[index] === undefined || args[index] === null) {
        throw new Error(`参数 ${index + 1} 是必需的`);
      }
    }
    return originalMethod.apply(this, args);
  };
}
```

**当前转换结果**：
```typescript
function MinLength(minLength: number) {
  return function (target: any, propertyKey: string) {
    let value: string;
    const setter = function (newValue: string) {
      if (newValue.length < minLength) {
        throw new Error(propertyKey + $t1('chang_du_bu_neng_xiao_yu') + minLength + $t1('ge_zi_fu_12gic5'));  // 拼接方式不一致
      }
      value = newValue;
    };
    // ...
  };
}

function Validate(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  const requiredParams: number[] = Reflect.getOwnMetadata('required', target, propertyKey) || [];

  descriptor.value = function (...args: any[]) {
    for (const index of requiredParams) {
      if (args[index] === undefined || args[index] === null) {
        throw new Error($t1('can_shu') + (index + 1) + $t1('shi_bi_xu_de'));  // 拼接方式不一致
      }
    }
    return originalMethod.apply(this, args);
  };
}
```

**期望结果**：
```typescript
// 应该先定义错误消息常量
export const ValidationErrors = {
  LENGTH_TOO_SHORT: (field: string, length: number) => $t1('field_length_error', { field, length }),
  PARAM_REQUIRED: (index: number) => $t1('param_required', { index: index + 1 })
} as const;

function MinLength(minLength: number) {
  return function (target: any, propertyKey: string) {
    let value: string;
    const setter = function (newValue: string) {
      if (newValue.length < minLength) {
        throw new Error(ValidationErrors.LENGTH_TOO_SHORT(propertyKey, minLength));
      }
      value = newValue;
    };
    // ...
  };
}

function Validate(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  const requiredParams: number[] = Reflect.getOwnMetadata('required', target, propertyKey) || [];

  descriptor.value = function (...args: any[]) {
    for (const index of requiredParams) {
      if (args[index] === undefined || args[index] === null) {
        throw new Error(ValidationErrors.PARAM_REQUIRED(index));
      }
    }
    return originalMethod.apply(this, args);
  };
}
```

### 12. 数组和集合处理问题

#### 12.1 数组字面量和方法链处理问题

**问题描述**：在处理数组字面量和方法链时，字符串的处理方式不一致。

**源代码**：
```javascript
// 数组字面量
const fruits = ['苹果', '香蕉', '橙子'];

// 数组方法链
const errors = [
  { type: 'validation', message: '用户名无效' },
  { type: 'network', message: '网络错误' },
  { type: 'validation', message: '密码太短' }
];

const messages = errors
  .filter(err => err.type === 'validation')
  .map(err => `验证错误：${err.message}`)
  .join('，');
```

**当前转换结果**：
```javascript
// 数组字面量
const fruits = [$t1('ping_guo'), $t1('xiang_jiao'), $t1('cheng_zi')];

// 数组方法链
const errors = [
  { type: 'validation', message: $t1('yong_hu_ming_wu_xiao') },
  { type: 'network', message: $t1('wang_luo_cuo_wu') },
  { type: 'validation', message: $t1('mi_ma_tai_duan') }
];

const messages = errors
  .filter((err) => err.type === 'validation')
  .map((err) => $t1('yan_zheng_cuo_wu') + err.message)  // 字符串拼接方式不一致
  .join('，');
```

**期望结果**：
```javascript
// 应该先定义常量
export const Fruits = {
  APPLE: $t1('ping_guo'),
  BANANA: $t1('xiang_jiao'),
  ORANGE: $t1('cheng_zi')
} as const;

export const ErrorMessages = {
  INVALID_USERNAME: $t1('yong_hu_ming_wu_xiao'),
  NETWORK_ERROR: $t1('wang_luo_cuo_wu'),
  PASSWORD_TOO_SHORT: $t1('mi_ma_tai_duan'),
  VALIDATION_ERROR: (message: string) => $t1('validation_error', { message })
} as const;

// 数组字面量
const fruits = [Fruits.APPLE, Fruits.BANANA, Fruits.ORANGE];

// 数组方法链
const errors = [
  { type: 'validation', message: ErrorMessages.INVALID_USERNAME },
  { type: 'network', message: ErrorMessages.NETWORK_ERROR },
  { type: 'validation', message: ErrorMessages.PASSWORD_TOO_SHORT }
];

const messages = errors
  .filter((err) => err.type === 'validation')
  .map((err) => ErrorMessages.VALIDATION_ERROR(err.message))
  .join('，');
```

#### 12.2 Set 和 Map 处理问题

**问题描述**：在处理 Set 和 Map 集合时，字符串的处理方式不一致。

**源代码**：
```javascript
// Set和Map
const statusSet = new Set(['待处理', '处理中', '已完成']);
const errorMap = new Map([
  ['404', '页面未找到'],
  ['500', '服务器错误']
]);
```

**当前转换结果**：
```javascript
// Set和Map
const statusSet = new Set([$t1('dai_chu_li'), $t1('chu_li_zhong'), $t1('yi_wan_cheng')]);
const errorMap = new Map([
  ['404', $t1('ye_mian_wei_zhao_dao')],
  ['500', $t1('fu_wu_qi_cuo_wu')]
]);
```

**期望结果**：
```javascript
// 应该先定义常量
export const Status = {
  PENDING: $t1('dai_chu_li'),
  PROCESSING: $t1('chu_li_zhong'),
  COMPLETED: $t1('yi_wan_cheng')
} as const;

export const HttpErrors = {
  NOT_FOUND: $t1('ye_mian_wei_zhao_dao'),
  SERVER_ERROR: $t1('fu_wu_qi_cuo_wu')
} as const;

// Set和Map
const statusSet = new Set([Status.PENDING, Status.PROCESSING, Status.COMPLETED]);
const errorMap = new Map([
  ['404', HttpErrors.NOT_FOUND],
  ['500', HttpErrors.SERVER_ERROR]
]);
```

#### 12.3 数组对象处理问题

**问题描述**：在处理数组中的对象和对象属性时，字符串的处理方式不一致。

**源代码**：
```javascript
// 数组中的对象
const users = [
  { id: 1, name: '张三', role: '管理员' },
  { id: 2, name: '李四', role: '编辑者' },
  { id: 3, name: '王五', role: '查看者' }
];

// 数组映射转换
const userRoles = users.map(user => `${user.name} (${user.role})`);

// 数组方法组合
const result = users
  .filter(user => user.id > 1)
  .map(user => ({ ...user, label: `用户：${user.name}` }))
  .reduce((acc, user) => {
    acc[user.id] = user.label;
    return acc;
  }, {});
```

**当前转换结果**：
```javascript
// 数组中的对象
const users = [
  { id: 1, name: $t1('zhang_san'), role: $t1('guan_li_yuan') },
  { id: 2, name: $t1('li_si'), role: $t1('bian_ji_zhe') },
  { id: 3, name: $t1('wang_wu'), role: $t1('cha_kan_zhe') }
];

// 数组映射转换
const userRoles = users.map((user) => `${user.name} (${user.role})`);  // 模板字符串未转换

// 数组方法组合
const result = users
  .filter((user) => user.id > 1)
  .map((user) => ({ ...user, label: $t1('yong_hu_2pj4w0') + user.name }))  // 字符串拼接方式不一致
  .reduce((acc, user) => {
    acc[user.id] = user.label;
    return acc;
  }, {});
```

**期望结果**：
```javascript
// 应该先定义常量
export const UserRoles = {
  ADMIN: $t1('guan_li_yuan'),
  EDITOR: $t1('bian_ji_zhe'),
  VIEWER: $t1('cha_kan_zhe')
} as const;

export const UserNames = {
  ZHANG_SAN: $t1('zhang_san'),
  LI_SI: $t1('li_si'),
  WANG_WU: $t1('wang_wu')
} as const;

export const UserLabels = {
  USER_ROLE: (name: string, role: string) => $t1('user_role_format', { name, role }),
  USER_LABEL: (name: string) => $t1('user_label_format', { name })
} as const;

// 数组中的对象
const users = [
  { id: 1, name: UserNames.ZHANG_SAN, role: UserRoles.ADMIN },
  { id: 2, name: UserNames.LI_SI, role: UserRoles.EDITOR },
  { id: 3, name: UserNames.WANG_WU, role: UserRoles.VIEWER }
];

// 数组映射转换
const userRoles = users.map((user) => UserLabels.USER_ROLE(user.name, user.role));

// 数组方法组合
const result = users
  .filter((user) => user.id > 1)
  .map((user) => ({ ...user, label: UserLabels.USER_LABEL(user.name) }))
  .reduce((acc, user) => {
    acc[user.id] = user.label;
    return acc;
  }, {});
```

[... 继续保留之前的内容 ...]